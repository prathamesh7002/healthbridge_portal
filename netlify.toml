[build]
  command = "npm run build"
  publish = ".next"

[build.environment]
  # Build settings
  NEXT_USE_TURBOPACK = "false"  # Disable Turbopack for Netlify builds
  NODE_VERSION = "20.11.1"  # Match your local Node.js version
  NPM_FLAGS = "--legacy-peer-deps"  # Helps with dependency resolution
  
  # Required environment variables for build
  NEXT_TELEMETRY_DISABLED = "1"
  NETLIFY_NEXT_PLUGIN_SKIP = "false"

[functions]
  node_bundler = "esbuild"  # Use esbuild for faster builds
  external_node_modules = ["@neondatabase/serverless"]

# Next.js plugin configuration
[[plugins]]
  package = "@netlify/plugin-nextjs"
  [plugins.inputs]
    enableStatic404 = true
    enableStatic500 = true
    experimental_plugin = true

# Neon database plugin
[[plugins]]
  package = "@netlify/plugin-neon"
  [plugins.inputs]
    # This will be set in Netlify environment variables
    connectionString = "${NEON_DATABASE_URL}"
